!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e.ReactRequest={},e.React)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var r={};function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,r=e.method,n=e.responseType,o=void 0===n?"":n,s=e.body,i=void 0===s?"":s;return[void 0===t?"":t,(void 0===r?"":r).toUpperCase(),o,i].join("||")}function o(e){return!!r[e]}function s(e){var t=e.requestKey,n=e.res,o=e.err;(r[t]||[]).forEach(function(e){n?e.resolve(n):e.reject(o)}),r[t]=null}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2],i=void 0,u=void 0;o?(i=o,u=t):t.responseType?(i=t,u={}):(i={},u=t);var a=i.responseType,c=void 0===a?"":a,p=i.dedupe,d=void 0===p||p,f=i.requestKey||n({url:e.url||e,method:u.method||e.method||"",body:u.body||e.body||""}),l=void 0;if(d){r[f]||(r[f]=[]);var h=r[f],y=!!h.length,v={};if(l=new Promise(function(e,t){v.resolve=e,v.reject=t}),h.push(v),y)return l}var m=fetch(e,u).then(function(e){var t=void 0;return t=c instanceof Function?c(e):c||(204===e.status?"text":"json"),e[t]().then(function(t){if(e.data=t,!d)return e;s({requestKey:f,res:e})},function(){if(e.data=null,!d)return e;s({requestKey:f,res:e})})},function(e){if(!d)return Promise.reject(e);s({requestKey:f,err:e})});return d?l:m}var u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},d={};var f=function(e){function r(e,t){u(this,r);var s=p(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return s.isReadRequest=function(e){var t=e.toUpperCase();return"GET"===t||"HEAD"===t||"OPTIONS"===t},s.isLazy=function(){var e=s.props,t=e.lazy;return void 0===t?!s.isReadRequest(e.method):t},s.shouldCacheResponse=function(){var e=s.props,t=e.cacheResponse;return void 0===t?s.isReadRequest(e.method):t},s.getFetchPolicy=function(){var e=s.props,t=e.fetchPolicy;return void 0===t?s.isReadRequest(e.method)?"cache-first":"network-only":t},s.cancelExistingRequest=function(e){if(s.state.fetching&&!s.hasHandledNetworkResponse){var t=Error(e);t.name="AbortError",s.onResponseReceived(c({},s.responseReceivedInfo,{error:t,hittingNetwork:!0}))}},s.fetchRenderProp=function(e){setTimeout(function(){s.fetchData(e,!0)})},s.getRequestKey=function(e){if(e&&e.requestKey)return e.requestKey;if(e){var t=Object.assign({},s.props,e);return n({url:t.url,body:t.body,method:t.method.toUpperCase()})}if(s.props.requestKey)return s.props.requestKey;var r=s.props;return n({url:r.url,body:r.body,method:r.method.toUpperCase()})},s.fetchData=function(e,t){var r=s.props,n=r.requestName,u=r.dedupe,a=r.beforeFetch;s.cancelExistingRequest("New fetch initiated");var p=s.getRequestKey(e),f=Object.assign({},s.props,e),l=f.url,h=f.body,y=f.credentials,v=f.headers,m=f.responseType,R=f.mode,q=f.cache,g=f.redirect,b=f.referrer,w=f.referrerPolicy,K=f.integrity,k=f.keepalive,P=f.signal,N=f.method.toUpperCase(),j=s.shouldCacheResponse(),O={body:h,credentials:y,headers:v,method:N,mode:R,cache:q,redirect:g,referrer:b,referrerPolicy:w,integrity:K,keepalive:k,signal:P},C={url:l,init:O,requestKey:p,responseType:m};s.responseReceivedInfo=C,s.hasHandledNetworkResponse=!1;var U=s.getFetchPolicy(),E=void 0;if("network-only"!==U&&!t)if(E=d[p]){if(s.onResponseReceived(c({},C,{response:E,hittingNetwork:!1,stillFetching:"cache-and-network"===U})),"cache-first"===U||"cache-only"===U)return Promise.resolve(E)}else if("cache-only"===U){var F=Error('Response for "'+n+'" not found in cache.');return s.onResponseReceived(c({},C,{error:F,hittingNetwork:!1})),Promise.resolve(F)}s.setState({requestKey:p,url:l,error:null,failed:!1,fetching:!0});var T=!o(p)||!u;return T&&a({url:l,init:O,requestKey:p}),i(l,O,{requestKey:p,responseType:m,dedupe:u}).then(function(e){return j&&(d[p]=e),s.hasHandledNetworkResponse||s.onResponseReceived(c({},C,{response:e,hittingNetwork:T})),e},function(e){return s.hasHandledNetworkResponse||s.onResponseReceived(c({},C,{error:e,cachedResponse:E,hittingNetwork:T})),e})},s.onResponseReceived=function(e){var t=e.error,r=void 0===t?null:t,n=e.response,o=void 0===n?null:n,i=e.hittingNetwork,u=e.url,a=e.init,c=e.requestKey,p=e.cachedResponse,d=e.stillFetching,f=void 0!==d&&d;s.responseReceivedInfo=null,f||(s.hasHandledNetworkResponse=!0);var l=void 0;o&&o.data?l=o.data:p&&p.data&&(l=p.data),l=l?s.props.transformData(l):null,r&&s.state.data&&(l=s.state.data),i&&s.props.afterFetch({url:u,init:a,requestKey:c,error:r,failed:!!(r||o&&!o.ok),response:o,data:l,didUnmount:!!s.willUnmount}),s.willUnmount||s.setState({url:u,data:l,error:r,response:o,fetching:f,requestKey:c},function(){return s.props.onResponse(r,o)})},s.state={requestKey:e.requestKey||n(c({},e,{method:e.method.toUpperCase()})),requestName:e.requestName,fetching:!1,response:null,data:null,error:null,url:e.url},s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,t.Component),a(r,[{key:"render",value:function(){var e=this.props,t=e.children,r=this.state,n=r.response,o=r.error;return t&&t({requestName:e.requestName,url:r.url,fetching:r.fetching,failed:!!(o||n&&!n.ok),response:n,data:r.data,requestKey:r.requestKey,error:o,doFetch:this.fetchRenderProp})||null}}]),a(r,[{key:"componentDidMount",value:function(){this.isLazy()||this.fetchData()}},{key:"componentDidUpdate",value:function(e){var t=this.props.requestKey||n(c({},this.props,{method:this.props.method.toUpperCase()}));t===(e.requestKey||n(c({},e,{method:e.method.toUpperCase()})))||this.isLazy()||this.fetchData({requestKey:t})}},{key:"componentWillUnmount",value:function(){this.willUnmount=!0,this.cancelExistingRequest("Component unmounted")}}]),r}();f.defaultProps={requestName:"anonymousRequest",onResponse:function(){},beforeFetch:function(){},afterFetch:function(){},transformData:function(e){return e},dedupe:!0,method:"get",referrerPolicy:"",integrity:"",referrer:"about:client"},e.Fetch=f,e.fetchDedupe=i,e.getRequestKey=n,e.isRequestInFlight=o,e.clearRequestCache=function(){r={}},e.clearResponseCache=function(){d={}},Object.defineProperty(e,"__esModule",{value:!0})});
